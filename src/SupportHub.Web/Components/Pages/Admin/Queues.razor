@page "/admin/queues"
@rendermode InteractiveServer
@attribute [Authorize(Policy = "Admin")]
@using SupportHub.Application.DTOs
@using SupportHub.Application.Interfaces

<PageTitle>Queue Management</PageTitle>

<div class="d-flex justify-space-between align-center mb-4">
    <MudText Typo="Typo.h5">Queue Management</MudText>
    <MudButton Variant="Variant.Filled" Color="Color.Primary" StartIcon="@Icons.Material.Filled.Add"
               OnClick="OpenCreateDialogAsync" Disabled="!_selectedCompanyId.HasValue">
        Add Queue
    </MudButton>
</div>

@if (_companies.Count > 1)
{
    <MudPaper Class="pa-3 mb-4">
        <MudSelect T="Guid" Label="Company" Value="_selectedCompanyId ?? Guid.Empty"
                   ValueChanged="OnCompanyChanged">
            @foreach (var company in _companies)
            {
                <MudSelectItem Value="@company.Id">@company.Name</MudSelectItem>
            }
        </MudSelect>
    </MudPaper>
}

@if (_error is not null)
{
    <MudAlert Severity="Severity.Error" Class="mb-4">@_error</MudAlert>
}

@if (_loading)
{
    <MudProgressLinear Indeterminate="true" />
}
else
{
    <MudDataGrid T="QueueDto" Items="@_queues" Hover="true" Dense="true" Striped="true">
        <Columns>
            <PropertyColumn Property="x => x.Name" Title="Name" />
            <PropertyColumn Property="x => x.CompanyName" Title="Company" />
            <PropertyColumn Property="x => x.Description" Title="Description" />
            <TemplateColumn Title="Default">
                <CellTemplate>
                    @if (context.Item.IsDefault)
                    {
                        <MudChip T="string" Size="Size.Small" Color="Color.Primary">Default</MudChip>
                    }
                </CellTemplate>
            </TemplateColumn>
            <TemplateColumn Title="Status">
                <CellTemplate>
                    <MudChip T="string" Size="Size.Small" Color="@(context.Item.IsActive ? Color.Success : Color.Default)">
                        @(context.Item.IsActive ? "Active" : "Inactive")
                    </MudChip>
                </CellTemplate>
            </TemplateColumn>
            <PropertyColumn Property="x => x.TicketCount" Title="Tickets" />
            <TemplateColumn Title="Actions">
                <CellTemplate>
                    <MudIconButton Icon="@Icons.Material.Filled.Edit" Size="Size.Small"
                                   OnClick="@(() => OpenEditDialogAsync(context.Item))" />
                    <MudIconButton Icon="@Icons.Material.Filled.Delete" Size="Size.Small" Color="Color.Error"
                                   OnClick="@(() => DeleteQueueAsync(context.Item))" />
                </CellTemplate>
            </TemplateColumn>
        </Columns>
    </MudDataGrid>
}
